<div class="p-8">
  <mat-card class="product-card-container">

    <!-- Title Section -->
    <div class="card-header-flex">
      <mat-card-title class="card-title-text">
        Attachment Inventory ({{ dataSource.data.length }} Items)
      </mat-card-title>

      <div *ngIf="error">
        {{ error }}
      </div>
      <div *ngIf="uploadResponse.status === 'error'">
        {{ uploadResponse.message }}
      </div>
      <div *ngIf="uploadResponse.status === 'progress' || uploadResponse.status === 'response'">

        <div role="progressbar" [style.width.%]="uploadResponse.message" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
          {{uploadResponse.message}}%
        </div>

      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">

        <input type="file" name="avatar" (change)="onFileChange($event)" />
        <button mat-flat-button class="upload-btn" type="submit">Upload</button>

      </form>

    </div>

    <mat-card-content>

      <div class="table-container shadow-md rounded-lg overflow-hidden">
        <table mat-table [dataSource]="dataSource" class="w-full">

          <!-- Map Column Definitions -->
          <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col">
            <!-- Header Cell -->
            <th mat-header-cell *matHeaderCellDef class="table-header-cell">
              {{ formatHeader(col) }}
            </th>

            <!-- Data Cell -->
            <td mat-cell *matCellDef="let row">
              <!-- Conditional rendering for Action buttons -->
              @if (col === 'action') {
              <button mat-flat-button class="action-btn download-btn" (click)="downloadFile(row)">
                Download
              </button>
              <button mat-flat-button class="action-btn delete-btn" (click)="deleteFile(row)">
                Delete
              </button>
              } @else if (col === 'recordCreated') {
                 {{ row[col] | date:'dd/MM/yyyy HH:mm:ss' }}
              } @else {
                 {{ row[col] }}
              }
            </td>
          </ng-container>

          <!-- Header Row (CRITICAL: Must be processed correctly by *matHeaderRowDef) -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
          <!-- Data Rows -->
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-data-row"></tr>
        </table>
      </div>

    </mat-card-content>

    <!-- Paginator Control -->
    <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]"
                   showFirstLastButtons
                   pageSize="10"
                   [length]="dataSource.data.length"
                   class="paginator-control"></mat-paginator>

  </mat-card>
</div>
